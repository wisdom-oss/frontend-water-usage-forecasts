<div class="columns">
  <div class="column">
    <p class="title">{{data.legalTitle}}</p>
    <p class="subtitle">
      <span *ngIf="data.subject">{{data.subject}}<br></span>
      <span *ngIf="data?.grantingAuthority">Granting Authority: {{data?.grantingAuthority}}<br></span>
      <span *ngIf="data?.registeringAuthority">Registering Authority: {{data?.registeringAuthority}}<br></span>
      <span *ngIf="data?.waterAuthority">Water Authority: {{data?.waterAuthority}}<br></span>
      <span *ngIf="data?.address">Address: {{data?.address}}<br></span>
      <span *ngIf="data?.bailee">Bailee: {{data?.bailee}}<br></span>
    </p>
  </div>
  <div *ngIf="data?.state || data?.dateOfChange || data?.valid" class="column is-narrow">
    <div *ngIf="data?.valid" class="is-flex is-flex-direction-column">
      <div class="pb-2">
        <div class="tag is-large" title="valid">
          <span class="icon-text">
            <span class="icon">
              <ion-icon name="time-outline"></ion-icon>
            </span>
            <span>{{validToString(data?.valid)}}</span>
          </span>
        </div>
      </div>
    </div>
    <div>
      <div class="tags is-justify-content-flex-end">
        <div *ngIf="data?.dateOfChange" class="tag is-large" title="date of change">
          <span class="icon-text">
            <span class="icon">
              <ion-icon name="pencil"></ion-icon>
            </span>
            <span>{{data?.dateOfChange?.toISOString()?.slice(0, 10)}}</span>
          </span>
          </div>
          <div class="tag is-large" title="{{data?.state}}">
          <span class="icon">
            <ion-icon
              *ngIf="data?.state === 'aktiv'"
              class="is-large is-size-1"
              name="play-outline"
            ></ion-icon>
            <ion-icon
              *ngIf="data?.state === 'inaktiv'"
              class="is-large is-size-1"
              name="pause-outline"
            ></ion-icon>
            <ion-icon
              *ngIf="data?.state === 'Wasserbuchblatt'"
              class="is-large is-size-1"
              name="document-text-outline"
            ></ion-icon>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="block">
  <div class="field is-grouped is-grouped-multiline">
    <div *ngIf="data?.id" class="control">
      <div class="tags has-addons">
        <span class="tag is-primary">Internal ID</span>
        <span class="tag">{{data?.id}}</span>
      </div>
    </div>
    <div *ngIf="data?.no" class="control">
      <div class="tags has-addons">
        <span class="tag is-primary">Water Right No.</span>
        <span class="tag">{{data?.no}}</span>
      </div>
    </div>
    <div *ngIf="data?.externalId" class="control">
      <div class="tags has-addons">
        <span class="tag is-primary">External ID</span>
        <span class="tag">{{data?.externalId}}</span>
      </div>
    </div>
    <div *ngIf="data?.fileReference" class="control">
      <div class="tags has-addons">
        <span class="tag is-primary">File Reference</span>
        <span class="tag">{{data?.fileReference}}</span>
      </div>
    </div>
  </div>
</div>

<div class="card block">
  <div class="card-content p-0 is-clipped">
    <map
      #map
      [layerSelectable]="false"
      zoom="12"
      height="300px"
      [scrollWheelZoom]="false"
      [markers]="markers"
    ></map>
  </div>
</div>

<div *ngIf="data?.locations?.length" class="card block">
  <div class="card-header">
    <p class="card-header-title">Locations</p>
  </div>
  <ng-template ngFor let-location [ngForOf]="data.locations">
    <div class="card-content" id="{{location?.id}}">
      <div class="level has-text-weight-bold">
        <div class="level-left">
          <span class="is-size-4">{{location?.name}}</span>
        </div>
        <div class="level-right">
          <span *ngIf="!location?.real" class="is-large is-size-4 icon"
                title="virtual">
            <ion-icon name="color-wand-outline"></ion-icon>
          </span>
          <span *ngIf="location?.active" class="is-large is-size-4 icon"
                title="active">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
          </span>
          <span *ngIf="!location?.active" class="is-large is-size-4 icon"
                title="inactive">
            <ion-icon name="close-circle-outline"></ion-icon>
          </span>
        </div>
      </div>
      <div *ngIf="location?.legalScope" class="block" style="margin-top: -27px">
        <p class="subtitle">{{location?.legalScope}}</p>
      </div>
      <div class="block">
        <div class="field is-grouped is-grouped-multiline" style="margin-top: -15px">
          <div class="control">
            <div class="tags has-addons">
              <span class="tag is-primary">Internal ID</span>
              <span class="tag">{{location?.id}}</span>
            </div>
          </div>
          <div *ngIf="location?.no" class="control">
            <div class="tags has-addons">
              <span class="tag is-primary">Location No.</span>
              <span class="tag">{{location?.no}}</span>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="location?.withdrawalRates" class="block">
        <p class="has-text-weight-bold">withdrawal</p>
        <div class="columns">
          <ng-template ngFor let-rate [ngForOf]="location?.withdrawalRates">
            <div class="column">
              <div
                class="message is-primary has-text-centered has-text-weight-bold">
                <div class="message-body">
                  {{rate.amount}} {{rate.unit}}/{{rate.duration}}
                </div>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
      <div *ngIf="location?.fluidDischarge" class="block">
        <p class="has-text-weight-bold">fluid discharge</p>
        <div class="columns">
          <ng-template ngFor let-rate [ngForOf]="location?.fluidDischarge">
            <div class="column">
              <div
                class="message is-primary has-text-centered has-text-weight-bold">
                <div class="message-body">
                  {{rate.amount}} {{rate.unit}}/{{rate.duration}}
                </div>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
      <div *ngIf="location?.irrigationArea" class="block">
        <p class="has-text-weight-bold">irrigation area</p>
        <div class="columns">
          <div class="column">
            <div
              class="message is-primary has-text-centered has-text-weight-bold">
              <div class="message-body">
                {{location?.irrigationArea?.amount}} {{location?.irrigationArea?.unit}}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="location?.rainSupplement" class="block">
        <p class="has-text-weight-bold">rain supplement</p>
        <div class="columns">
          <div class="column">
            <div
              class="message is-primary has-text-centered has-text-weight-bold">
              <div class="message-body">
                {{location?.rainSupplement?.amount}} {{location?.rainSupplement?.unit}}
                /{{location?.rainSupplement?.duration}}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="block">
        <table class="table is-fullwidth">
          <tbody>
          <tr *ngIf="location?.basinNo">
            <td>basinNo</td>
            <td>{{location?.basinNo?.key}} {{location?.basinNo?.name}}</td>
          </tr>
          <tr *ngIf="location?.county">
            <td>county</td>
            <td>{{location?.county}}</td>
          </tr>
          <tr *ngIf="location?.euSurveyArea">
            <td>euSurveyArea</td>
            <td>{{location?.euSurveyArea?.key}} {{location?.euSurveyArea?.name}}</td>
          </tr>
          <tr *ngIf="location?.field">
            <td>field</td>
            <td>{{location?.field}}</td>
          </tr>
          <tr *ngIf="location?.groundwaterVolume">
            <td>groundwaterVolume</td>
            <td>{{location?.groundwaterVolume}}</td>
          </tr>
          <tr *ngIf="location?.localSubDistrict">
            <td>localSubDistrict</td>
            <td>{{location?.localSubDistrict}}</td>
          </tr>
          <tr *ngIf="location?.maintenanceAssociation">
            <td>maintenanceAssociation</td>
            <td>{{location?.maintenanceAssociation?.key}} {{location?.maintenanceAssociation?.name}}</td>
          </tr>
          <tr *ngIf="location?.municipalArea">
            <td>municipalArea</td>
            <td>{{location?.municipalArea?.key}} {{location?.municipalArea?.name}}</td>
          </tr>
          <tr *ngIf="location?.plot">
            <td>plot</td>
            <td>{{location?.plot}}</td>
          </tr>
          <tr *ngIf="location?.rivershed">
            <td>rivershed</td>
            <td>{{location?.rivershed}}</td>
          </tr>
          <tr *ngIf="location?.serialNo">
            <td>serialNo</td>
            <td>{{location?.serialNo}}</td>
          </tr>
          <tr *ngIf="location?.topMap1to25000">
            <td>topMap1to25000</td>
            <td>{{location?.topMap1to25000?.key}} {{location?.topMap1to25000?.name}}</td>
          </tr>
          <tr *ngIf="location?.waterBody">
            <td>waterBody</td>
            <td>{{location?.waterBody}}</td>
          </tr>
          <tr *ngIf="location?.floodArea">
            <td>floodArea</td>
            <td>{{location?.floodArea}}</td>
          </tr>
          <tr *ngIf="location?.waterProtectionArea">
            <td>waterProtectionArea</td>
            <td>{{location?.waterProtectionArea}}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </ng-template>
</div>

<div *ngIf="data?.annotation?.length" class="card block">
  <div class="card-header">
    <div class="card-header-title">Annotation</div>
  </div>
  <div class="card-content">
    <p class="content">{{data?.annotation}}</p>
  </div>
</div>
